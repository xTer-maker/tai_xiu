<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LUXURY CASINO | Management Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;900&family=Orbitron:wght@500;900&display=swap');
        
        body {
            font-family: 'Montserrat', sans-serif;
            background: #020617;
            color: #f8fafc;
            overflow-x: hidden;
            background-image: radial-gradient(circle at 50% 0%, #1e1b4b 0%, #020617 70%);
        }

        .font-game { font-family: 'Orbitron', sans-serif; }
        .glass { background: rgba(15, 23, 42, 0.7); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.1); }
        .gold-glow {
            background: linear-gradient(to right, #fbbf24, #fef3c7, #d97706);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 0 10px rgba(245, 158, 11, 0.4));
        }

        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }

        .diamond { position: absolute; width: 20px; height: 20px; pointer-events: none; z-index: 1000; }
        @keyframes fall {
            0% { transform: translateY(-10vh) rotate(0deg) scale(0); opacity: 1; }
            100% { transform: translateY(110vh) rotate(720deg) scale(1.2); opacity: 0; }
        }

        .modal-enter { animation: modalIn 0.3s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes modalIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <!-- Audio Effects -->
    <audio id="snd-spin" src="https://assets.mixkit.co/active_storage/sfx/2016/2016-preview.mp3"></audio>
    <audio id="snd-win" src="https://assets.mixkit.co/active_storage/sfx/2021/2021-preview.mp3"></audio>
    <audio id="snd-lose" src="https://assets.mixkit.co/active_storage/sfx/2019/2019-preview.mp3"></audio>

    <div id="diamond-layer" class="fixed inset-0 pointer-events-none z-[1000]"></div>

    <!-- Auth UI -->
    <div id="auth-container" class="w-full max-w-md glass p-10 rounded-[3rem] shadow-2xl">
        <div class="text-center mb-10">
            <h1 class="text-5xl font-black font-game gold-glow italic tracking-tighter">LUXURY</h1>
            <p class="text-slate-500 text-[10px] tracking-[0.5em] uppercase mt-2 font-bold">H·ªá Th·ªëng Diamond</p>
        </div>

        <div id="login-form" class="space-y-4">
            <input type="email" id="login-email" placeholder="Email h·ªôi vi√™n" class="w-full bg-slate-900/50 border border-slate-700 p-4 rounded-2xl outline-none focus:border-amber-500">
            <input type="password" id="login-password" placeholder="M·∫≠t kh·∫©u" class="w-full bg-slate-900/50 border border-slate-700 p-4 rounded-2xl outline-none focus:border-amber-500">
            <button onclick="handleLogin()" class="w-full bg-amber-600 p-4 rounded-2xl font-bold text-lg shadow-xl shadow-amber-900/20">ƒêƒÇNG NH·∫¨P</button>
            <p class="text-center text-sm text-slate-500">Ng∆∞·ªùi m·ªõi? <button onclick="toggleAuth(false)" class="text-amber-400 font-bold">ƒêƒÉng k√Ω</button></p>
        </div>

        <div id="register-form" class="hidden space-y-4">
            <input type="text" id="reg-name" placeholder="T√™n hi·ªÉn th·ªã" class="w-full bg-slate-900/50 border border-slate-700 p-4 rounded-2xl outline-none focus:border-amber-500">
            <input type="email" id="reg-email" placeholder="Email" class="w-full bg-slate-900/50 border border-slate-700 p-4 rounded-2xl outline-none focus:border-amber-500">
            <input type="password" id="reg-password" placeholder="M·∫≠t kh·∫©u (6+ k√Ω t·ª±)" class="w-full bg-slate-900/50 border border-slate-700 p-4 rounded-2xl outline-none focus:border-amber-500">
            <button onclick="handleRegister()" class="w-full bg-amber-600 p-4 rounded-2xl font-bold text-lg">T·∫†O T√ÄI KHO·∫¢N</button>
            <p class="text-center text-sm text-slate-500">ƒê√£ c√≥ t√†i kho·∫£n? <button onclick="toggleAuth(true)" class="text-amber-400 font-bold">ƒêƒÉng nh·∫≠p</button></p>
        </div>
    </div>

    <!-- Main Game UI -->
    <div id="game-container" class="hidden w-full max-w-6xl flex flex-col gap-6 relative">
        
        <!-- Top Left: Directory (Admin Only) -->
        <button id="btn-directory" onclick="toggleModal('modal-directory')" class="hidden absolute -top-2 -left-2 w-12 h-12 bg-slate-800 rounded-full flex items-center justify-center border border-white/10 shadow-lg z-50">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" /></svg>
        </button>

        <!-- Navbar -->
        <div class="glass p-6 rounded-[2.5rem] flex justify-between items-center">
            <div class="flex items-center gap-4">
                <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-amber-400 to-yellow-700 flex items-center justify-center font-black text-black text-xl">VIP</div>
                <div>
                    <h2 class="text-lg font-black flex items-center">
                        <span id="display-username">...</span>
                        <span id="admin-tag" class="hidden bg-red-600 text-[10px] px-2 py-0.5 rounded-full ml-2 font-bold">ADMIN</span>
                    </h2>
                    <p class="text-3xl font-black font-game gold-glow" id="display-balance">0</p>
                </div>
            </div>

            <div class="flex items-center gap-3">
                <!-- Shield Icon (Admin Logic) -->
                <button id="btn-shield" onclick="toggleModal('modal-shield')" class="hidden w-14 h-14 rounded-2xl bg-red-900/30 border border-red-500/30 flex items-center justify-center hover:bg-red-900/50 transition-all">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-7 h-7 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" /></svg>
                </button>
                <!-- Profile Avatar -->
                <button onclick="toggleModal('modal-profile')" class="w-14 h-14 rounded-2xl bg-slate-800 border border-white/10 flex items-center justify-center hover:scale-105 active:scale-95 transition-all overflow-hidden">
                    <img id="profile-img" src="https://api.dicebear.com/7.x/avataaars/svg?seed=Lucky" class="w-full h-full object-cover">
                </button>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6 h-[550px]">
            <div class="lg:col-span-4 glass rounded-[3rem] p-10 flex flex-col justify-between">
                <div class="space-y-6">
                    <h4 class="text-xs font-bold uppercase tracking-widest text-slate-500 flex items-center gap-2">
                        <span class="w-2 h-2 bg-amber-500 rounded-full animate-ping"></span>C·ªïng C∆∞·ª£c Diamond
                    </h4>
                    <input type="number" id="bet-amount" value="10000" class="w-full bg-black/40 border border-white/5 p-6 rounded-3xl text-3xl font-black outline-none text-amber-500 font-game">
                    
                    <div class="space-y-4">
                        <div class="flex justify-between items-center text-[10px] font-bold uppercase text-slate-500">
                            <span>T·ª∑ l·ªá nh√¢n: <span id="val-multiplier" class="text-amber-500">1.5x</span></span>
                        </div>
                        <input type="range" id="range-multiplier" min="1.1" max="9.9" step="0.1" value="1.5" class="w-full accent-amber-500">
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <button onclick="playGame('tai')" class="group relative p-8 rounded-[2rem] bg-amber-600 font-black text-center overflow-hidden active:scale-95 transition-all">
                        <span class="relative z-10 text-xs uppercase opacity-70">Tr√™n</span>
                        <div class="relative z-10 text-3xl font-game" id="label-tai">50</div>
                    </button>
                    <button onclick="playGame('xiu')" class="group relative p-8 rounded-[2rem] bg-slate-800 border border-white/10 font-black text-center overflow-hidden active:scale-95 transition-all">
                        <span class="relative z-10 text-xs uppercase opacity-70">D∆∞·ªõi</span>
                        <div class="relative z-10 text-3xl font-game" id="label-xiu">50</div>
                    </button>
                </div>
            </div>

            <div class="lg:col-span-8 glass rounded-[3rem] flex flex-col items-center justify-center relative overflow-hidden">
                <div id="dice-display" class="text-[14rem] font-black font-game gold-glow leading-none select-none">?</div>
                <div id="status-text" class="text-2xl font-black uppercase tracking-[0.3em] opacity-0 transition-all mt-4">...</div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <!-- Profile Modal -->
    <div id="modal-profile" class="hidden fixed inset-0 z-[2000] flex items-center justify-center p-4 bg-black/80 backdrop-blur-md">
        <div class="glass w-full max-w-md p-8 rounded-[3rem] modal-enter">
            <div class="flex flex-col items-center text-center space-y-4">
                <div class="w-24 h-24 rounded-3xl bg-amber-500 mb-2 flex items-center justify-center text-4xl shadow-2xl">üíé</div>
                <h3 id="prof-name" class="text-2xl font-black">...</h3>
                <p id="prof-uid" class="text-[10px] text-slate-500 tracking-widest font-bold">UID: 000000</p>
                
                <div class="w-full grid grid-cols-2 gap-3 mt-4">
                    <div class="bg-black/40 p-4 rounded-2xl">
                        <p class="text-[10px] text-slate-500 uppercase font-bold mb-1">S·ªë d∆∞</p>
                        <p id="prof-balance" class="text-xl font-black text-amber-500">0</p>
                    </div>
                    <div class="bg-black/40 p-4 rounded-2xl">
                        <p class="text-[10px] text-slate-500 uppercase font-bold mb-1">Ch·ª©c v·ª•</p>
                        <p id="prof-rank" class="text-xl font-black">H·ªôi Vi√™n</p>
                    </div>
                </div>

                <div class="w-full space-y-3 pt-6 border-t border-white/5">
                    <input type="password" id="new-pass" placeholder="M·∫≠t kh·∫©u m·ªõi..." class="w-full bg-black/40 border border-white/10 p-4 rounded-xl outline-none text-sm">
                    <button onclick="updatePassword()" class="w-full py-3 bg-slate-800 rounded-xl font-bold text-sm">C·∫≠p Nh·∫≠t M·∫≠t Kh·∫©u</button>
                </div>

                <div class="w-full pt-4">
                    <input type="text" id="admin-code-input" placeholder="Nh·∫≠p m√£ Admin..." class="w-full bg-red-900/10 border border-red-500/20 p-4 rounded-xl outline-none text-sm text-red-500">
                    <button onclick="applyAdmin()" class="w-full mt-2 py-3 bg-red-600/20 text-red-500 rounded-xl font-bold text-xs uppercase tracking-widest">K√≠ch Ho·∫°t Admin</button>
                </div>

                <div class="flex gap-2 w-full pt-6">
                    <button onclick="handleLogout()" class="flex-1 py-4 bg-rose-600/20 text-rose-500 rounded-2xl font-bold text-sm uppercase">ƒêƒÉng Xu·∫•t</button>
                    <button onclick="toggleModal('modal-profile')" class="flex-1 py-4 bg-white/5 rounded-2xl font-bold text-sm uppercase">ƒê√≥ng</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Shield Modal -->
    <div id="modal-shield" class="hidden fixed inset-0 z-[2000] flex items-center justify-center p-4 bg-black/80 backdrop-blur-md">
        <div class="glass w-full max-w-xl p-10 rounded-[3rem] modal-enter">
            <h3 class="text-2xl font-black text-red-500 mb-8 flex items-center gap-3">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" /></svg>
                QU·∫¢N TR·ªä VI√äN
            </h3>
            
            <div class="space-y-6">
                <div class="space-y-2">
                    <label class="text-[10px] font-bold text-slate-500 uppercase">UID M·ª•c ti√™u</label>
                    <input type="number" id="adm-target-uid" placeholder="Nh·∫≠p UID 6 s·ªë..." class="w-full bg-black/40 border border-white/10 p-4 rounded-xl outline-none font-game">
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <button onclick="admAction('ban')" class="p-6 bg-slate-800 rounded-2xl text-center hover:bg-slate-700">
                        <p class="text-[10px] text-slate-500 uppercase mb-1">Tr·∫°ng th√°i</p>
                        <p class="font-bold text-rose-500">Kh√≥a / M·ªü</p>
                    </button>
                    <button onclick="admAction('delete')" class="p-6 bg-rose-900/20 border border-rose-500/20 rounded-2xl text-center hover:bg-rose-900/40">
                        <p class="text-[10px] text-slate-500 uppercase mb-1">Nguy hi·ªÉm</p>
                        <p class="font-bold text-rose-500 uppercase">X√≥a Vƒ©nh Vi·ªÖn</p>
                    </button>
                </div>

                <div class="space-y-4 pt-4">
                    <input type="number" id="adm-amount" placeholder="S·ªë Diamond (+/-)..." class="w-full bg-black/40 border border-white/10 p-4 rounded-xl outline-none font-game text-amber-500">
                    <button onclick="admAction('money')" class="w-full py-4 bg-emerald-600 rounded-2xl font-black uppercase text-sm">ƒêi·ªÅu ch·ªânh s·ªë d∆∞</button>
                </div>
            </div>

            <button onclick="toggleModal('modal-shield')" class="w-full mt-8 py-4 bg-white/5 rounded-2xl font-bold uppercase text-xs tracking-widest">Quay l·∫°i</button>
        </div>
    </div>

    <!-- Directory Modal -->
    <div id="modal-directory" class="hidden fixed inset-0 z-[2000] flex items-center justify-center p-4 bg-black/90 backdrop-blur-xl">
        <div class="glass w-full max-w-4xl p-10 rounded-[4rem] h-[80vh] flex flex-col modal-enter">
            <div class="flex justify-between items-center mb-8">
                <h2 class="text-3xl font-black text-amber-500 flex items-center gap-4">
                    DANH B·∫† H·ªòI VI√äN
                    <span id="user-count" class="text-xs bg-white/10 px-3 py-1 rounded-full text-slate-400">0</span>
                </h2>
                <button onclick="toggleModal('modal-directory')" class="w-12 h-12 bg-white/5 rounded-full flex items-center justify-center">‚úï</button>
            </div>
            <div id="dir-list" class="flex-1 overflow-y-auto space-y-3 pr-2 custom-scroll"></div>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyC2CbNUKK7FyX3fRLnqFV01JVdnPfVsotU",
            authDomain: "mybetgame-c7b8c.firebaseapp.com",
            projectId: "mybetgame-c7b8c",
            storageBucket: "mybetgame-c7b8c.firebasestorage.app",
            messagingSenderId: "298730080386",
            appId: "1:298730080386:web:9dc19f94dab52df710cc9b"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        let user = null, userData = null, isPlaying = false, targetX = 50;

        // Auth Listener
        auth.onAuthStateChanged(async (u) => {
            if (u) {
                user = u;
                const ref = db.collection('users').doc(u.uid);
                const doc = await ref.get();
                if(doc.exists) {
                    userData = doc.data();
                    if(userData.banned) {
                        alert("T√†i kho·∫£n c·ªßa b·∫°n ƒë√£ b·ªã kh√≥a!");
                        return auth.signOut();
                    }
                    document.getElementById('auth-container').classList.add('hidden');
                    document.getElementById('game-container').classList.remove('hidden');
                    setupUserUI();
                    startListen();
                }
            } else {
                document.getElementById('auth-container').classList.remove('hidden');
                document.getElementById('game-container').classList.add('hidden');
            }
        });

        function setupUserUI() {
            document.getElementById('profile-img').src = `https://api.dicebear.com/7.x/avataaars/svg?seed=${userData.username}`;
            updateLabels();
        }

        function startListen() {
            db.collection('users').doc(user.uid).onSnapshot(doc => {
                userData = doc.data();
                document.getElementById('display-balance').innerText = userData.balance.toLocaleString();
                document.getElementById('display-username').innerText = userData.username;
                document.getElementById('prof-name').innerText = userData.username;
                document.getElementById('prof-uid').innerText = `UID: ${userData.uid}`;
                document.getElementById('prof-balance').innerText = userData.balance.toLocaleString();
                
                if(userData.isAdmin) {
                    document.getElementById('admin-tag').classList.remove('hidden');
                    document.getElementById('btn-shield').classList.remove('hidden');
                    document.getElementById('btn-directory').classList.remove('hidden');
                    document.getElementById('prof-rank').innerText = "QU·∫¢N TR·ªä";
                    document.getElementById('prof-rank').className = "text-xl font-black text-red-500";
                }
            });
        }

        // C·∫≠p nh·∫≠t nh√£n Tr√™n/D∆∞·ªõi d·ª±a tr√™n Multiplier
        // Logic: Nh√¢n c√†ng cao, t·ª∑ l·ªá th·∫Øng c√†ng th·∫•p (V√πng an to√†n thu h·∫πp)
        function updateLabels() {
            const m = parseFloat(document.getElementById('range-multiplier').value);
            document.getElementById('val-multiplier').innerText = m.toFixed(1) + 'x';
            
            // X·ª≠ l√Ω t·ª∑ l·ªá X: T·ª∑ l·ªá nh√¢n 1.1x -> X kho·∫£ng 10. T·ª∑ l·ªá nh√¢n 9.9x -> X kho·∫£ng 90.
            // C√¥ng th·ª©c: x = multiplier * 10
            targetX = Math.floor(m * 10);
            if(targetX > 98) targetX = 98;
            if(targetX < 2) targetX = 2;

            document.getElementById('label-tai').innerText = targetX;
            document.getElementById('label-xiu').innerText = (100 - targetX);
        }

        document.getElementById('range-multiplier').oninput = updateLabels;

        // Game Play
        async function playGame(choice) {
            if(isPlaying) return;
            const amt = parseInt(document.getElementById('bet-amount').value);
            if(amt > userData.balance || amt < 1000) return alert("S·ªë d∆∞ kh√¥ng ƒë·ªß ho·∫∑c c∆∞·ª£c t·ªëi thi·ªÉu 1k");

            isPlaying = true;
            document.getElementById('snd-spin').play();
            const status = document.getElementById('status-text');
            status.innerText = "ƒêANG T√çNH TO√ÅN...";
            status.style.opacity = "1";
            status.className = "text-2xl font-black uppercase tracking-[0.3em] mt-4 text-amber-500 animate-pulse";

            let cycle = 0;
            const anim = setInterval(() => {
                document.getElementById('dice-display').innerText = Math.floor(Math.random() * 99) + 1;
                cycle++;
                if(cycle > 20) {
                    clearInterval(anim);
                    const result = Math.floor(Math.random() * 100) + 1;
                    
                    // Logic th·∫Øng:
                    // 'tai' (Tr√™n X): K·∫øt qu·∫£ > X
                    // 'xiu' (D∆∞·ªõi 100-X): K·∫øt qu·∫£ < (100-X)
                    const isWin = (choice === 'tai' && result > targetX) || (choice === 'xiu' && result < (100 - targetX));
                    const mult = parseFloat(document.getElementById('range-multiplier').value);
                    const change = isWin ? Math.floor(amt * mult) : -amt;

                    db.collection('users').doc(user.uid).update({ balance: firebase.firestore.FieldValue.increment(change) });

                    document.getElementById('dice-display').innerText = result;
                    status.innerText = isWin ? `TH·∫ÆNG +${change.toLocaleString()} ‚ú®` : `THUA ${Math.abs(change).toLocaleString()} üíÄ`;
                    status.className = `text-3xl font-black uppercase tracking-widest mt-4 ${isWin ? 'text-emerald-400' : 'text-rose-600'}`;
                    status.classList.remove('animate-pulse');

                    if(isWin) { document.getElementById('snd-win').play(); doRain(); }
                    else document.getElementById('snd-lose').play();
                    
                    isPlaying = false;
                }
            }, 60);
        }

        function doRain() {
            for(let i=0; i<40; i++) {
                setTimeout(() => {
                    const d = document.createElement('div');
                    d.className = 'diamond'; d.innerHTML = 'üíé';
                    d.style.left = Math.random() * 100 + 'vw';
                    d.style.animation = `fall ${Math.random() * 2 + 1}s linear forwards`;
                    document.getElementById('diamond-layer').appendChild(d);
                    setTimeout(() => d.remove(), 3000);
                }, i * 50);
            }
        }

        // Admin Actions
        async function admAction(type) {
            const uid = parseInt(document.getElementById('adm-target-uid').value);
            if(!uid) return alert("Nh·∫≠p UID m·ª•c ti√™u");
            
            const snap = await db.collection('users').where('uid', '==', uid).get();
            if(snap.empty) return alert("Kh√¥ng t√¨m th·∫•y ng∆∞·ªùi d√πng n√†y");
            const docId = snap.docs[0].id;
            const ref = db.collection('users').doc(docId);

            if(type === 'ban') {
                const isBanned = snap.docs[0].data().banned;
                await ref.update({ banned: !isBanned });
                alert(isBanned ? "ƒê√£ m·ªü kh√≥a" : "ƒê√£ kh√≥a t√†i kho·∫£n");
            } else if(type === 'delete') {
                if(confirm("X√°c nh·∫≠n x√≥a vƒ©nh vi·ªÖn?")) {
                    await ref.delete();
                    alert("ƒê√£ x√≥a kh·ªèi h·ªá th·ªëng");
                }
            } else if(type === 'money') {
                const a = parseInt(document.getElementById('adm-amount').value);
                if(!a) return alert("Nh·∫≠p s·ªë ti·ªÅn");
                await ref.update({ balance: firebase.firestore.FieldValue.increment(a) });
                alert("ƒê√£ c·∫≠p nh·∫≠t s·ªë d∆∞");
            }
        }

        // Directory
        async function loadDirectory() {
            const list = document.getElementById('dir-list');
            list.innerHTML = `<p class="text-center py-10 opacity-50">ƒêang t·∫£i danh s√°ch...</p>`;
            const snap = await db.collection('users').get();
            list.innerHTML = "";
            document.getElementById('user-count').innerText = snap.size;
            
            snap.forEach(doc => {
                const u = doc.data();
                const item = document.createElement('div');
                item.className = "bg-white/5 p-5 rounded-3xl flex justify-between items-center border border-white/5 hover:border-white/10 transition-all";
                item.innerHTML = `
                    <div class="flex items-center gap-4">
                        <div class="w-10 h-10 rounded-xl bg-slate-800 flex items-center justify-center font-bold text-xs">${u.username[0].toUpperCase()}</div>
                        <div>
                            <p class="font-bold text-sm">${u.username} ${u.isAdmin ? 'üëë' : ''}</p>
                            <p class="text-[10px] text-slate-500">UID: ${u.uid} | IP: ${u.lastIP || '?'}</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="text-amber-500 font-bold text-sm">${u.balance.toLocaleString()} VND</p>
                        <p class="text-[9px] ${u.banned ? 'text-rose-500' : 'text-emerald-500'} font-bold uppercase">${u.banned ? 'B·ªã Kh√≥a' : 'Ho·∫°t ƒë·ªông'}</p>
                    </div>
                `;
                list.appendChild(item);
            });
        }

        // Helpers
        window.toggleModal = (id) => {
            const m = document.getElementById(id);
            m.classList.toggle('hidden');
            if(id === 'modal-directory' && !m.classList.contains('hidden')) loadDirectory();
        };

        window.toggleAuth = (isL) => {
            document.getElementById('login-form').classList.toggle('hidden', !isL);
            document.getElementById('register-form').classList.toggle('hidden', isL);
        };

        window.handleLogin = async () => {
            const e = document.getElementById('login-email').value;
            const p = document.getElementById('login-password').value;
            try { await auth.signInWithEmailAndPassword(e, p); } catch(err) { alert("Sai th√¥ng tin ƒëƒÉng nh·∫≠p"); }
        };

        window.handleRegister = async () => {
            const n = document.getElementById('reg-name').value;
            const e = document.getElementById('reg-email').value;
            const p = document.getElementById('reg-password').value;
            if(p.length < 6) return alert("M·∫≠t kh·∫©u t·ªëi thi·ªÉu 6 k√Ω t·ª±");
            try {
                const c = await auth.createUserWithEmailAndPassword(e, p);
                const uid = Math.floor(100000 + Math.random() * 899999);
                await db.collection('users').doc(c.user.uid).set({
                    uid, username: n, balance: 100000, banned: false, isAdmin: false, createdAt: Date.now()
                });
            } catch(err) { alert(err.message); }
        };

        window.updatePassword = async () => {
            const p = document.getElementById('new-pass').value;
            if(p.length < 6) return alert("M·∫≠t kh·∫©u m·ªõi qu√° ng·∫Øn");
            try {
                await auth.currentUser.updatePassword(p);
                alert("ƒê√£ ƒë·ªïi m·∫≠t kh·∫©u!");
                document.getElementById('new-pass').value = "";
            } catch(e) { alert("Vui l√≤ng ƒëƒÉng nh·∫≠p l·∫°i tr∆∞·ªõc khi ƒë·ªïi MK"); }
        };

        window.applyAdmin = async () => {
            const code = document.getElementById('admin-code-input').value;
            if(code === "LUXURY99") {
                await db.collection('users').doc(user.uid).update({ isAdmin: true });
                alert("ƒê√£ k√≠ch ho·∫°t ƒë·∫∑c quy·ªÅn Admin!");
                toggleModal('modal-profile');
            } else {
                alert("M√£ Admin kh√¥ng ch√≠nh x√°c");
            }
        };

        window.handleLogout = () => auth.signOut().then(() => window.location.reload());
    </script>
</body>
</html>

